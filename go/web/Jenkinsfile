podTemplate(
  cloud: 'kubernetes',
  namespace: 'jenkins',
  activeDeadlineSeconds: '300',
  showRawYaml: 'false',
  containers: [
  containerTemplate(
    name: 'centos',
    image: 'centos:centos7',
    ttyEnabled: true,
    privileged: true,
    command: '/usr/sbin/init'
  )
]) {
  node(POD_LABEL) {
      try {
        // project variables
        def project_directory = "${WORKSPACE}/go/web"

/*
          stage("Get Golang Project") {
            git url: 'https://github.com/Condoamanti/programming.git'
          } // stage end
*/
          container('centos') {
            stage('Download Docker Dependencies') {
              sh """
              rm -rf /etc/yum.repos.d/*

              echo \"# Artifactory Repository
[artifactory-centos-7-os]
name=artifactory-centos-7-os
baseurl=http://admin:AP72goB1ugbhNixgk4oZQD1JSMK@k8snode1dc1.jittersolutions.com:32382/artifactory/rpm/7/os/x86_64
enabled=1
gpgcheck=0

[artifactory-centos-7-extras]
name=artifactory-centos-7-extras
baseurl=http://admin:AP72goB1ugbhNixgk4oZQD1JSMK@k8snode1dc1.jittersolutions.com:32382/artifactory/rpm/7/extras/x86_64
enabled=1
gpgcheck=0


[artifactory-centos-7-fasttrack]
name=artifactory-centos-7-fasttrack
baseurl=http://admin:AP72goB1ugbhNixgk4oZQD1JSMK@k8snode1dc1.jittersolutions.com:32382/artifactory/rpm/7/fasttrack/x86_64
enabled=1
gpgcheck=0

[artifactory-centos-7-updates]
name=artifactory-centos-7-updates
baseurl=http://admin:AP72goB1ugbhNixgk4oZQD1JSMK@k8snode1dc1.jittersolutions.com:32382/artifactory/rpm/7/updates/x86_64
enabled=1
gpgcheck=0

[artifactory-centos-7-cr]
name=artifactory-centos-7-cr
baseurl=http://admin:AP72goB1ugbhNixgk4oZQD1JSMK@k8snode1dc1.jittersolutions.com:32382/artifactory/rpm/7/cr/x86_64
enabled=1
gpgcheck=0\" >> /etc/yum.repos.d/artifactory.repo

              yum update --assume-yes --quiet

              yum install --assumeyes --quiet container-selinux
              yum install --assumeyes --quiet epel-release
              yum install --assumeyes --quiet yum-utils
              
              yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
              yum install --assumeyes --quiet docker-ce
              
              yum clean all

              systemctl start docker
              systemctl status docker
              docker run --privileged busybox:latest
              """
            } // stage end
          } // container end
      } catch (err) {
        echo "Caught: ${err}"
        currentBuild.result = 'FAILURE'
      } finally {
    }
  } // node end
} // podTemplate end